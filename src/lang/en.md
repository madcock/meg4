<!-- Generated by bin2h, DO NOT edit -->
# Memory Map

## Misc

All values are little endian, so the smaller digit is stored on the smaller address.

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|  00000 |          1 | MEG-4 firmware version major                                       |
|  00001 |          1 | MEG-4 firmware version minor                                       |
|  00002 |          1 | MEG-4 firmware version bugfix                                      |
|  00003 |          1 | performance counter, last frame's unspent time in 1/1000th secs    |
|  00004 |          4 | number of 1/1000th second ticks since power on                     |
|  00008 |          8 | UTC unix timestamp                                                 |
|  00010 |          2 | current locale                                                     |

The performance counter shows the time unspent when the last frame was generated. If this is zero or negative, then it means
how much your loop() function has overstepped its available timeframe.

## Pointer

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|  00012 |          2 | pointer buttons state (see [getbtn] and [getclk])                  |
|  00014 |          2 | pointer sprite index                                               |
|  00016 |          2 | pointer X coordinate                                               |
|  00018 |          2 | pointer Y coordinate                                               |

The pointer buttons are as follows:

| Define  | Bitmask   | Description                                                        |
|---------|----------:|--------------------------------------------------------------------|
| `BTN_L` |         1 | Left mouse button                                                  |
| `BTN_M` |         2 | Middle mouse button                                                |
| `BTN_R` |         4 | Right mouse button                                                 |
| `SCR_U` |         8 | Scroll up                                                          |
| `SCR_D` |        16 | Scroll down                                                        |
| `SCR_L` |        32 | Scroll left                                                        |
| `SCR_R` |        64 | Scroll right                                                       |

The upper bits of the pointer sprite index are used for hotspots: bit 13-15 hotspot Y, bit 10-12 hotspot X, bit 0-9 sprite.
There are some predefined built-in cursors:

| Define       | Value     | Description                                                   |
|--------------|----------:|---------------------------------------------------------------|
| `PTR_NORM`   |      03fb | Normal (arrow) pointer                                        |
| `PTR_TEXT`   |      03fc | Text pointer                                                  |
| `PTR_HAND`   |      0bfd | Link pointer                                                  |
| `PTR_ERR`    |      93fe | Error pointer                                                 |
| `PTR_NONE`   |      ffff | The pointer is hidden                                         |

## Keyboard

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|  0001A |          1 | keyboard queue tail                                                |
|  0001B |          1 | keyboard queue head                                                |
|  0001C |         64 | keyboard queue, 16 elements, each 4 bytes (see [popkey])           |
|  0005C |         18 | keyboard keys pressed state by scancodes (see [getkey])            |

The keys popped from the queue are represented in UTF-8. Some invalid UTF-8 sequences represent special (non-printable)
keys, for example:

| Keycode | Description                                     |
|---------|-------------------------------------------------|
| `\x8`   | The character 8, <kbd>Backspace</kbd> key       |
| `\x9`   | The character 9, <kbd>Tab</kbd> key             |
| `\n`    | The character 10, <kbd>⏎Enter</kbd> key         |
| `\x1b`  | The character 27, <kbd>Esc</kbd> key            |
| `Del`   | The <kbd>Del</kbd> key                          |
| `Up`    | The cursor arrow <kbd>▴</kbd> key               |
| `Down`  | The cursor arrow <kbd>▾</kbd> key               |
| `Left`  | The cursor arrow <kbd>◂</kbd> key               |
| `Rght`  | The cursor arrow <kbd>▸</kbd> key               |
| `Cut`   | The Cut key (or <kbd>Ctrl</kbd>+<kbd>X</kbd>)   |
| `Cpy`   | The Copy key (or <kbd>Ctrl</kbd>+<kbd>C</kbd>)  |
| `Pst`   | The Paste key (or <kbd>Ctrl</kbd>+<kbd>V</kbd>) |

The scancodes are as follows:

| ScanCode | Address | Bitmask | Define            |
|---------:|---------|--------:|-------------------|
|        0 |   0005C |       1 | `KEY_CHEAT`       |
|        1 |   0005C |       2 | `KEY_F1`          |
|        2 |   0005C |       4 | `KEY_F2`          |
|        3 |   0005C |       8 | `KEY_F3`          |
|        4 |   0005C |      16 | `KEY_F4`          |
|        5 |   0005C |      32 | `KEY_F5`          |
|        6 |   0005C |      64 | `KEY_F6`          |
|        7 |   0005C |     128 | `KEY_F7`          |
|        8 |   0005D |       1 | `KEY_F8`          |
|        9 |   0005D |       2 | `KEY_F9`          |
|       10 |   0005D |       4 | `KEY_F10`         |
|       11 |   0005D |       8 | `KEY_F11`         |
|       12 |   0005D |      16 | `KEY_F12`         |
|       13 |   0005D |      32 | `KEY_PRSCR`       |
|       14 |   0005D |      64 | `KEY_SCRLOCK`     |
|       15 |   0005D |     128 | `KEY_PAUSE`       |
|       16 |   0005E |       1 | `KEY_BACKQUOTE`   |
|       17 |   0005E |       2 | `KEY_1`           |
|       18 |   0005E |       4 | `KEY_2`           |
|       19 |   0005E |       8 | `KEY_3`           |
|       20 |   0005E |      16 | `KEY_4`           |
|       21 |   0005E |      32 | `KEY_5`           |
|       22 |   0005E |      64 | `KEY_6`           |
|       23 |   0005E |     128 | `KEY_7`           |
|       24 |   0005F |       1 | `KEY_8`           |
|       25 |   0005F |       2 | `KEY_9`           |
|       26 |   0005F |       4 | `KEY_0`           |
|       27 |   0005F |       8 | `KEY_MINUS`       |
|       28 |   0005F |      16 | `KEY_EQUAL`       |
|       29 |   0005F |      32 | `KEY_BACKSPACE`   |
|       30 |   0005F |      64 | `KEY_TAB`         |
|       31 |   0005F |     128 | `KEY_Q`           |
|       32 |   00060 |       1 | `KEY_W`           |
|       33 |   00060 |       2 | `KEY_E`           |
|       34 |   00060 |       4 | `KEY_R`           |
|       35 |   00060 |       8 | `KEY_T`           |
|       36 |   00060 |      16 | `KEY_Y`           |
|       37 |   00060 |      32 | `KEY_U`           |
|       38 |   00060 |      64 | `KEY_I`           |
|       39 |   00060 |     128 | `KEY_O`           |
|       40 |   00061 |       1 | `KEY_P`           |
|       41 |   00061 |       2 | `KEY_LBRACKET`    |
|       42 |   00061 |       4 | `KEY_RBRACKET`    |
|       43 |   00061 |       8 | `KEY_ENTER`       |
|       44 |   00061 |      16 | `KEY_CAPSLOCK`    |
|       45 |   00061 |      32 | `KEY_A`           |
|       46 |   00061 |      64 | `KEY_S`           |
|       47 |   00061 |     128 | `KEY_D`           |
|       48 |   00062 |       1 | `KEY_F`           |
|       49 |   00062 |       2 | `KEY_G`           |
|       50 |   00062 |       4 | `KEY_H`           |
|       51 |   00062 |       8 | `KEY_J`           |
|       52 |   00062 |      16 | `KEY_K`           |
|       53 |   00062 |      32 | `KEY_L`           |
|       54 |   00062 |      64 | `KEY_SEMICOLON`   |
|       55 |   00062 |     128 | `KEY_APOSTROPHE`  |
|       56 |   00063 |       1 | `KEY_BACKSLASH`   |
|       57 |   00063 |       2 | `KEY_LSHIFT`      |
|       58 |   00063 |       4 | `KEY_LESS`        |
|       59 |   00063 |       8 | `KEY_Z`           |
|       60 |   00063 |      16 | `KEY_X`           |
|       61 |   00063 |      32 | `KEY_C`           |
|       62 |   00063 |      64 | `KEY_V`           |
|       63 |   00063 |     128 | `KEY_B`           |
|       64 |   00064 |       1 | `KEY_N`           |
|       65 |   00064 |       2 | `KEY_M`           |
|       66 |   00064 |       4 | `KEY_COMMA`       |
|       67 |   00064 |       8 | `KEY_PERIOD`      |
|       68 |   00064 |      16 | `KEY_SLASH`       |
|       69 |   00064 |      32 | `KEY_RSHIFT`      |
|       70 |   00064 |      64 | `KEY_LCTRL`       |
|       71 |   00064 |     128 | `KEY_LSUPER`      |
|       72 |   00065 |       1 | `KEY_LALT`        |
|       73 |   00065 |       2 | `KEY_SPACE`       |
|       74 |   00065 |       4 | `KEY_RALT`        |
|       75 |   00065 |       8 | `KEY_RSUPER`      |
|       76 |   00065 |      16 | `KEY_MENU`        |
|       77 |   00065 |      32 | `KEY_RCTRL`       |
|       78 |   00065 |      64 | `KEY_INS`         |
|       79 |   00065 |     128 | `KEY_HOME`        |
|       80 |   00066 |       1 | `KEY_PGUP`        |
|       81 |   00066 |       2 | `KEY_DEL`         |
|       82 |   00066 |       4 | `KEY_END`         |
|       83 |   00066 |       8 | `KEY_PGDN`        |
|       84 |   00066 |      16 | `KEY_UP`          |
|       85 |   00066 |      32 | `KEY_LEFT`        |
|       86 |   00066 |      64 | `KEY_DOWN`        |
|       87 |   00066 |     128 | `KEY_RIGHT`       |
|       88 |   00067 |       1 | `KEY_NUMLOCK`     |
|       89 |   00067 |       2 | `KEY_KP_DIV`      |
|       90 |   00067 |       4 | `KEY_KP_MUL`      |
|       91 |   00067 |       8 | `KEY_KP_SUB`      |
|       92 |   00067 |      16 | `KEY_KP_7`        |
|       93 |   00067 |      32 | `KEY_KP_8`        |
|       94 |   00067 |      64 | `KEY_KP_9`        |
|       95 |   00067 |     128 | `KEY_KP_ADD`      |
|       96 |   00068 |       1 | `KEY_KP_4`        |
|       97 |   00068 |       2 | `KEY_KP_5`        |
|       98 |   00068 |       4 | `KEY_KP_6`        |
|       99 |   00068 |       8 | `KEY_KP_1`        |
|      100 |   00068 |      16 | `KEY_KP_2`        |
|      101 |   00068 |      32 | `KEY_KP_3`        |
|      102 |   00068 |      64 | `KEY_KP_ENTER`    |
|      103 |   00068 |     128 | `KEY_KP_0`        |
|      104 |   00069 |       1 | `KEY_KP_DEC`      |
|      105 |   00069 |       2 | `KEY_INT1`        |
|      106 |   00069 |       4 | `KEY_INT2`        |
|      107 |   00069 |       8 | `KEY_INT3`        |
|      108 |   00069 |      16 | `KEY_INT4`        |
|      109 |   00069 |      32 | `KEY_INT5`        |
|      110 |   00069 |      64 | `KEY_INT6`        |
|      111 |   00069 |     128 | `KEY_INT7`        |
|      112 |   0006A |       1 | `KEY_INT8`        |
|      113 |   0006A |       2 | `KEY_LNG1`        |
|      114 |   0006A |       4 | `KEY_LNG2`        |
|      115 |   0006A |       8 | `KEY_LNG3`        |
|      116 |   0006A |      16 | `KEY_LNG4`        |
|      117 |   0006A |      32 | `KEY_LNG5`        |
|      118 |   0006A |      64 | `KEY_LNG6`        |
|      119 |   0006A |     128 | `KEY_LNG7`        |
|      120 |   0006B |       1 | `KEY_LNG8`        |
|      121 |   0006B |       2 | `KEY_APP`         |
|      122 |   0006B |       4 | `KEY_POWER`       |
|      123 |   0006B |       8 | `KEY_KP_EQUAL`    |
|      124 |   0006B |      16 | `KEY_EXEC`        |
|      125 |   0006B |      32 | `KEY_HELP`        |
|      126 |   0006B |      64 | `KEY_SELECT`      |
|      127 |   0006B |     128 | `KEY_STOP`        |
|      128 |   0006C |       1 | `KEY_AGAIN`       |
|      129 |   0006C |       2 | `KEY_UNDO`        |
|      130 |   0006C |       4 | `KEY_CUT`         |
|      131 |   0006C |       8 | `KEY_COPY`        |
|      132 |   0006C |      16 | `KEY_PASTE`       |
|      133 |   0006C |      32 | `KEY_FIND`        |
|      134 |   0006C |      64 | `KEY_MUTE`        |
|      135 |   0006C |     128 | `KEY_VOLUP`       |
|      136 |   0006D |       1 | `KEY_VOLDN`       |


## Gamepad

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|  0006E |          2 | gamepad joystick treshold (defaults to 8000)                       |
|  00070 |          8 | primary gamepad - keyboard scancode mappings (see [keyboard])      |
|  00078 |          4 | 4 gamepads button pressed state (see [getpad])                     |

The gamepad buttons are as follows:

| Define  | Bitmask   | Description                                                        |
|---------|----------:|--------------------------------------------------------------------|
| `BTN_L` |         1 | The `◁` button or joystick left                                   |
| `BTN_U` |         2 | The `△` button or joystick up                                     |
| `BTN_R` |         4 | The `▷` button or joystick right                                  |
| `BTN_D` |         8 | The `▽` button or joystick down                                   |
| `BTN_A` |        16 | The `Ⓐ` button                                                     |
| `BTN_B` |        32 | The `Ⓑ` button                                                     |
| `BTN_X` |        64 | The `Ⓧ` button                                                     |
| `BTN_Y` |       128 | The `Ⓨ` button                                                     |

The `△△▽▽◁▷◁▷ⒷⒶ` sequence makes the `KEY_CHEAT` "key" pressed.

## Graphics Processing Unit

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|  0007E |          1 | UNICODE code point upper bits for font glyph mapping               |
|  0007F |          1 | sprite bank selector for the map                                   |
|  00080 |       1024 | palette, 256 colors, each entry 4 bytes, RGBA                      |
|  00480 |          2 | x0, crop area X start in pixels (for all drawing functions)        |
|  00482 |          2 | x1, crop area X end in pixels                                      |
|  00484 |          2 | y0, crop area Y start in pixels                                    |
|  00486 |          2 | y1, crop area Y end in pixels                                      |
|  00488 |          2 | displayed vram X offset in pixels or 0xffff                        |
|  0048A |          2 | displayed vram Y offset in pixels or 0xffff                        |
|  0048C |          1 | turtle pen down flag (see [up], [down])                            |
|  0048D |          1 | turtle pen color, palette index 0 to 255 (see [color])             |
|  0048E |          2 | turtle direction in degrees, 0 to 359 (see [left], [right])        |
|  00490 |          2 | turtle X offset in pixels (see [move])                             |
|  00492 |          2 | turtle Y offset in pixels                                          |
|  00494 |          2 | maze walking speed in 1/128 tiles (see [maze])                     |
|  00496 |          2 | maze rotating speed in degrees (1 to 90)                           |
|  00498 |          2 | camera X offset in pixels (see [tri3d])                            |
|  0049A |          2 | camera Y offset in pixels                                          |
|  0049C |          2 | camera Z offset in pixels                                          |
|  0049E |          1 | console foreground color, palette index 0 to 255 (see [printf])    |
|  0049F |          1 | console background color, palette index 0 to 255                   |
|  004A0 |          2 | console X offset in pixels                                         |
|  004A2 |          2 | console Y offset in pixels                                         |
|  00600 |      64000 | map, 320 x 200 sprite indeces (see [map] and [maze])               |
|  10000 |      65536 | sprites, 256 x 256 palette indeces, 1024 8 x 8 pixels (see [spr])  |
|  28000 |       2048 | window for 4096 font glyphs (see 0007E, [width] and [text])        |

## Digital Signal Processor

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|  0007C |          1 | waveform bank selector (1 to 31)                                   |
|  0007D |          1 | music track bank selector (0 to 7)                                 |
|  004BA |          1 | current tempo (in ticks per row, read-only)                        |
|  004BB |          1 | current track being played (read-only)                             |
|  004BC |          2 | current row being played (read-only)                               |
|  004BE |          2 | number of total rows in current track (read-only)                  |
|  004C0 |         64 | 16 channel status registers, each 4 bytes (read-only)              |
|  00500 |        256 | 64 sound effects, each 4 bytes                                     |
|  20000 |      16384 | window for waveform samples (see 0007C)                            |
|  24000 |      16384 | window for music patterns (see 0007D)                              |

The DSP status registers are all read-only, and for each channel they look like:

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|      0 |          2 | current position in the waveform being played                      |
|      2 |          1 | current waveform (1 to 31, 0 if the channel is silent)             |
|      3 |          1 | current volume (0 means channel is turned off)                     |

The first 4 channels are for the music, the rest for the sound effects.

Note that the waveform index 0 means "use the previous waveform", so index 0 cannot be used in the selector.
The format of every other waveform:

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|      0 |          2 | number of samples                                                  |
|      2 |          2 | loop start                                                         |
|      4 |          2 | loop length                                                        |
|      6 |          1 | finetune value, -8 to 7                                            |
|      7 |          1 | volume, 0 to 64                                                    |
|      8 |      16376 | signed 8-bit mono samples                                          |

The format of the sound effects and the music tracks are the same, the only difference is, music tracks have 4 notes per row,
one for each channel, and there are 1024 rows; while for sound effects there's only one note and 64 rows.

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|      0 |          1 | note number, see `NOTE_x` defines, 0 to 96                         |
|      1 |          1 | waveform index, 0 to 31                                            |
|      2 |          1 | effect type, 0 to 255                                              |
|      3 |          1 | effect parameter                                                   |

The counting of notes goes as follows: 0 means no note set. Followed by 8 octaves, each with 12 notes, so 1 equals to C-0,
12 is B-0 (on the lowest octave), 13 is C-1 (one octave higher) and 14 is C#1 (C sharp, semitone higher). For example the
D note on the 4th octave would be 1 + 4\*12 + 2 = 51. The B-7 is 96, the highest note on the highest octave. You also have
built-in defines, for example C-1 is `NOTE_C_1` and C#1 is `NOTE_Cs1`, if you don't want to count then you can use these as well
in your program.

For simplicity, MEG-4 uses the same codes as the Amiga MOD file (this way you'll see the same in the built-in editor as well
as in a third party music tracker), but it does not support all of them. As said earlier, these codes are represented by three
hex numbers, the first being the type `t`, and the last two the parameter, `xy` (or `xx`). The types `E1` to `ED` are all stored
in the type byte, although it looks like one of their nibble might belong to the parameter, but it's not.

| Effect | Code | Description                                                |
|--------|------|------------------------------------------------------------|
| ...    | 000  | No effect                                                  |
| Arp    | 0xy  | Arpeggio, play note, note+x semitone and note+y semitone   |
| Po/    | 1xx  | Portamento up, slide period by x up                        |
| Po\\   | 2xx  | Portamento down, slide period by x up                      |
| Ptn    | 3xx  | Tone portamento, slide period to period x                  |
| Vib    | 4xy  | Vibrato, oscillate the pitch by y semitones at x freq      |
| Ctv    | 5xy  | Continue Tone portamento + volume slide by x up or y down  |
| Cvv    | 6xy  | Continue Vibrato + volume slide by x up or by y down       |
| Trm    | 7xy  | Tremolo, oscillate the volume by y amplitude at x freq     |
| Ofs    | 9xx  | Set sample offset to x \* 256                              |
| Vls    | Axy  | Slide volume by x up or by y down                          |
| Jmp    | Bxx  | Position jump, set row to x \* 64                          |
| Vol    | Cxx  | Set volume to x                                            |
| Fp/    | E1x  | Fine portamento up, increase period by x                   |
| Fp\\   | E2x  | Fine portamento down, decrease period by x                 |
| Svw    | E4x  | Set vibrato waveform, 0 sine, 1 saw, 2 square, 3 noise     |
| Ftn    | E5x  | Set finetune, change tuning by x (-8 to 7)                 |
| Stw    | E7x  | Set tremolo waveform, 0 sine, 1 saw, 2 square, 3 noise     |
| Rtg    | E9x  | Retrigger note, trigger current sample every x ticks       |
| Fv/    | EAx  | Fine volume slide up, increase by x                        |
| Fv\\   | EBx  | Fine volume slide down, decrease by x                      |
| Cut    | ECx  | Cut note in x ticks                                        |
| Dly    | EDx  | Delay note in x ticks                                      |
| Tpr    | Fxx  | Set number of ticks per row to x (tick defalts to 6)       |

## User Memory

Memory addresses from 00000 to 2FFFF belong to the MMIO, everything above (starting from 30000 or `MEM_USER`) is freely usable
user memory.

| Offset | Size       | Description                                                        |
|--------|-----------:|--------------------------------------------------------------------|
|  30000 |          4 | (BASIC only) offset of DATA                                        |
|  30004 |          4 | (BASIC only) current READ counter                                  |
|  30008 |          4 | (BASIC only) maximum READ, number of DATA                          |

This is followed by the global variables that you have declared in your program, followed by the constants, like string literals.
In case of BASIC, then this is followed by the actual DATA records.

Memory addresses above the initialized data can be dynamically allocated and freed in your program via the [malloc] and [free] calls.

Lastly the stack, which is at the top (starting from C0000 or `MEM_LIMIT`) and growing *downwards*. Your program's local variables
(that you declared inside a function) go here. The size of the stack always changes depending on which function calls which other
function in your program.

If by any chance the top of the dynamically allocated data and the bottom of the stack would overlap, then MEG-4 throws an
"Out of memory" error.

## Format String

Some functions, [printf], [sprintf] and [trace] use a format string that may contain special characters to reference arguments
and to describe how to display them. These are:

| Code | Description                                                |
|------|------------------------------------------------------------|
| `%%` | The `%` character                                          |
| `%d` | Print the next parameter as a decimal number               |
| `%u` | Print the next parameter as an unsigned decimal number     |
| `%x` | Print the next parameter as a hexadecimal number           |
| `%o` | Print the next parameter as an octal number                |
| `%b` | Print the next parameter as a binary number                |
| `%f` | Print the next parameter as a floating point number        |
| `%s` | Print the next parameter as a string                       |
| `%c` | Print the next parameter as an UTF-8 character             |
| `%p` | Print the next parameter as an address (pointer)           |
| `\t` | Tab, fix vertical position before continue printing        |
| `\n` | Start a new line for printing                              |

You can add padding by specifying the length between `%` and the code. If that starts with `0`, then value will be padded
with zeros, otherwise with spaces. For example `%4d` will pad the value to the right with spaces, and `%04x` with zeros.
The `f` accepts a number after a dot, which tells the number of digits in the fractional part (up to 8), eg. `%.6f`.

# Console

## putc

```c
void putc(uint32_t chr)
```
<dt>Description</dt><dd>
Prints a character to console.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| chr | UTF-8 character |
</dd>
<hr>
## printf

```c
void printf(str_t fmt, ...)
```
<dt>Description</dt><dd>
Prints text to console.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| fmt | string to display, a [format string] |
| ... | optional arguments |
</dd>
<hr>
## getc

```c
uint32_t getc(void)
```
<dt>Description</dt><dd>
Reads a character from console, blocks program when there's no input.
</dd>
<dt>Return Value</dt><dd>
An UTF-8 character the user entered.
</dd>
<dt>See Also</dt><dd>
[popkey]
</dd>
<hr>
## gets

```c
str_t gets(void)
```
<dt>Description</dt><dd>
Reads in a newline terminated string from user (does not return the newline).
</dd>
<dt>Return Value</dt><dd>
The bytes read in a string.
</dd>
<hr>
## trace

```c
void trace(str_t fmt, ...)
```
<dt>Description</dt><dd>
Trace execution by printing to stdout. Only works if `meg4` was started with the `-v` verbose flag.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| fmt | [format string] |
| ... | optional arguments |
</dd>
<hr>
## delay

```c
void delay(uint16_t msec)
```
<dt>Description</dt><dd>
Delays program execution.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| msec | delay in milliseconds |
</dd>
<hr>
## exit

```c
void exit(void)
```
<dt>Description</dt><dd>
Exits program.
</dd>

# Audio

## sfx

```c
void sfx(uint8_t sfx, uint8_t channel, uint8_t volume)
```
<dt>Description</dt><dd>
Plays a sound effect.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| sfx | the index of the sound effect, 0 to 63 |
| channel | channel to be used, 0 to 11 |
| volume | volume to be used, 0 to 255, 0 turns off channel |
</dd>
<hr>
## music

```c
void music(uint8_t track, uint16_t row, uint8_t volume)
```
<dt>Description</dt><dd>
Plays a music track.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| track | the index of the music track, 0 to 7 |
| row | row to start playing from, 0 to 1023 (max song length) |
| volume | volume to be used, 0 to 255, 0 turns off music |
</dd>

# Graphics

## cls

```c
void cls(uint8_t palidx)
```
<dt>Description</dt><dd>
Clears the entire screen and resets display offsets, also sets the console's background color.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
</dd>
<dt>See Also</dt><dd>
[pget], [pset]
</dd>
<hr>
## cget

```c
uint32_t cget(uint16_t x, uint16_t y)
```
<dt>Description</dt><dd>
Get pixel at a coordinate and return color RGBA.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
</dd>
<dt>Return Value</dt><dd>
A packed color, with RGBA channels (red is in the least significant byte).
</dd>
<dt>See Also</dt><dd>
[cls], [pget], [pset]
</dd>
<hr>
## pget

```c
uint8_t pget(uint16_t x, uint16_t y)
```
<dt>Description</dt><dd>
Get pixel at a coordinate and return its palette index.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
</dd>
<dt>Return Value</dt><dd>
Color in palette index, 0 to 255.
</dd>
<dt>See Also</dt><dd>
[cls], [pset], [cget]
</dd>
<hr>
## pset

```c
void pset(uint8_t palidx, uint16_t x, uint16_t y)
```
<dt>Description</dt><dd>
Plots a pixel at a coordinate.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[cls], [pget]
</dd>
<hr>
## width

```c
uint16_t width(int8_t type, str_t str)
```
<dt>Description</dt><dd>
Returns displayed text's width in pixels.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| type | font type, -4 to 4 |
| str | string to measure |
</dd>
<dt>Return Value</dt><dd>
Number of pixels required to display text.
</dd>
<dt>See Also</dt><dd>
[text]
</dd>
<hr>
## text

```c
void text(uint8_t palidx, int16_t x, int16_t y, int8_t type, uint8_t shidx, uint8_t sha, str_t str)
```
<dt>Description</dt><dd>
Prints text on screen.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
| type | font type, -4 to -1 monospace, 1 to 4 proportional |
| shidx | shadow's color, palette index 0 to 255 |
| sha | shadow's alpha, 0 (fully transparent) to 255 (fully opaque) |
| str | string to display |
</dd>
<dt>See Also</dt><dd>
[width]
</dd>
<hr>
## line

```c
void line(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1)
```
<dt>Description</dt><dd>
Draws an anti-aliased line.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | starting X coordinate in pixels |
| y0 | starting Y coordinate in pixels |
| x1 | ending X coordinate in pixels |
| y1 | ending Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[qbez], [cbez]
</dd>
<hr>
## qbez

```c
void qbez(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1,
    int16_t cx, int16_t cy)
```
<dt>Description</dt><dd>
Draws a quadratic Bezier curve.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | starting X coordinate in pixels |
| y0 | starting Y coordinate in pixels |
| x1 | ending X coordinate in pixels |
| y1 | ending Y coordinate in pixels |
| cx | control point X coordinate in pixels |
| cy | control point Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[line], [cbez]
</dd>
<hr>
## cbez

```c
void cbez(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1,
    int16_t cx0, int16_t cy0, int16_t cx1, int16_t cy1)
```
<dt>Description</dt><dd>
Draws a cubic Bezier curve.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | starting X coordinate in pixels |
| y0 | starting Y coordinate in pixels |
| x1 | ending X coordinate in pixels |
| y1 | ending Y coordinate in pixels |
| cx0 | first control point X coordinate in pixels |
| cy0 | first control point Y coordinate in pixels |
| cx1 | second control point X coordinate in pixels |
| cy1 | second control point Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[line], [qbez]
</dd>
<hr>
## tri

```c
void tri(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1, int16_t x2, int16_t y2)
```
<dt>Description</dt><dd>
Draws a triangle.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | first edge X coordinate in pixels |
| y0 | first edge Y coordinate in pixels |
| x1 | second edge X coordinate in pixels |
| y1 | second edge Y coordinate in pixels |
| x2 | third edge X coordinate in pixels |
| y2 | third edge Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[ftri], [tri2d], [tri3d]
</dd>
<hr>
## ftri

```c
void ftri(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1, int16_t x2, int16_t y2)
```
<dt>Description</dt><dd>
Draws a filled triangle.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | first edge X coordinate in pixels |
| y0 | first edge Y coordinate in pixels |
| x1 | second edge X coordinate in pixels |
| y1 | second edge Y coordinate in pixels |
| x2 | third edge X coordinate in pixels |
| y2 | third edge Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[tri], [tri2d], [tri3d]
</dd>
<hr>
## tri2d

```c
void tri2d(uint8_t pi0, int16_t x0, int16_t y0,
    uint8_t pi1, int16_t x1, int16_t y1,
    uint8_t pi2, int16_t x2, int16_t y2)
```
<dt>Description</dt><dd>
Draws a filled triangle with color gradients.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| pi0 | first edge color, palette index 0 to 255 |
| x0 | first edge X coordinate in pixels |
| y0 | first edge Y coordinate in pixels |
| pi1 | second edge color, palette index 0 to 255 |
| x1 | second edge X coordinate in pixels |
| y1 | second edge Y coordinate in pixels |
| pi2 | third edge color, palette index 0 to 255 |
| x2 | third edge X coordinate in pixels |
| y2 | third edge Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[tri], [ftri], [tri3d]
</dd>
<hr>
## tri3d

```c
void tri3d(uint8_t pi0, int16_t x0, int16_t y0, int16_t z0,
    uint8_t pi1, int16_t x1, int16_t y1, int16_t z1,
    uint8_t pi2, int16_t x2, int16_t y2, int16_t z2)
```
<dt>Description</dt><dd>
Draws a filled triangle with color gradients in 3D space from the camera perspective (see [Graphics Processing Unit] address 00498).
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| pi0 | first edge color, palette index 0 to 255 |
| x0 | first edge X coordinate in pixels |
| y0 | first edge Y coordinate in pixels |
| z0 | first edge Z coordinate in pixels |
| pi1 | second edge color, palette index 0 to 255 |
| x1 | second edge X coordinate in pixels |
| y1 | second edge Y coordinate in pixels |
| z1 | second edge Z coordinate in pixels |
| pi2 | third edge color, palette index 0 to 255 |
| x2 | third edge X coordinate in pixels |
| y2 | third edge Y coordinate in pixels |
| z2 | third edge Z coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[tri], [ftri], [tri2d]
</dd>
<hr>
## rect

```c
void rect(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1)
```
<dt>Description</dt><dd>
Draws a rectangle.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | top left corner X coordinate in pixels |
| y0 | top left corner Y coordinate in pixels |
| x1 | bottom right X coordinate in pixels |
| y1 | bottom right Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[frect]
</dd>
<hr>
## frect

```c
void frect(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1)
```
<dt>Description</dt><dd>
Draws a filled rectangle.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | top left corner X coordinate in pixels |
| y0 | top left corner Y coordinate in pixels |
| x1 | bottom right X coordinate in pixels |
| y1 | bottom right Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[rect]
</dd>
<hr>
## circ

```c
void circ(uint8_t palidx, int16_t x, int16_t y, uint16_t r)
```
<dt>Description</dt><dd>
Draws a circle.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x | center X coordinate in pixels |
| y | center Y coordinate in pixels |
| r | radius in pixels |
</dd>
<dt>See Also</dt><dd>
[fcirc], [ellip], [fellip]
</dd>
<hr>
## fcirc

```c
void fcirc(uint8_t palidx, int16_t x, int16_t y, uint16_t r)
```
<dt>Description</dt><dd>
Draws a filled circle.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x | center X coordinate in pixels |
| y | center Y coordinate in pixels |
| r | radius in pixels |
</dd>
<dt>See Also</dt><dd>
[circ], [ellip], [fellip]
</dd>
<hr>
## ellip

```c
void ellip(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1)
```
<dt>Description</dt><dd>
Draws an ellipse.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | top left corner X coordinate in pixels |
| y0 | top left corner Y coordinate in pixels |
| x1 | bottom right X coordinate in pixels |
| y1 | bottom right Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[circ], [fcirc], [fellip]
</dd>
<hr>
## fellip

```c
void fellip(uint8_t palidx, int16_t x0, int16_t y0, int16_t x1, int16_t y1)
```
<dt>Description</dt><dd>
Draws a filled ellipse.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
| x0 | top left corner X coordinate in pixels |
| y0 | top left corner Y coordinate in pixels |
| x1 | bottom right X coordinate in pixels |
| y1 | bottom right Y coordinate in pixels |
</dd>
<dt>See Also</dt><dd>
[circ], [fcirc], [ellip]
</dd>
<hr>
## move

```c
void move(int16_t x, int16_t y, uint16_t deg)
```
<dt>Description</dt><dd>
Moves turtle to the given position on screen or in the maze.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| x | X coordinate in pixels (or 1/128 tiles with [maze]) |
| y | Y coordinate in pixels |
| deg | direction in degrees, 0 to 359, 0 is upwards on screen, 90 is to the right |
</dd>
<dt>See Also</dt><dd>
[left], [right], [up], [down], [color], [forw], [back]
</dd>
<hr>
## left

```c
void left(uint16_t deg)
```
<dt>Description</dt><dd>
Turns turtle left.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| deg | change in degrees, 0 to 359 |
</dd>
<dt>See Also</dt><dd>
[move], [right], [up], [down], [color], [forw], [back]
</dd>
<hr>
## right

```c
void right(uint16_t deg)
```
<dt>Description</dt><dd>
Turns turtle right.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| deg | change in degrees, 0 to 359 |
</dd>
<dt>See Also</dt><dd>
[move], [left], [up], [down], [color], [forw], [back]
</dd>
<hr>
## up

```c
void up(void)
```
<dt>Description</dt><dd>
Lifts turtle's tail up. The turtle will move without drawing a line.
</dd>
<dt>See Also</dt><dd>
[move], [left], [right], [down], [color], [forw], [back]
</dd>
<hr>
## down

```c
void down(void)
```
<dt>Description</dt><dd>
Puts turtle's tail down. The turtle will move drawing a line (see [color]).
</dd>
<dt>See Also</dt><dd>
[move], [left], [right], [up], [color], [forw], [back]
</dd>
<hr>
## color

```c
void color(uint8_t palidx)
```
<dt>Description</dt><dd>
Sets turtle paint color.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| palidx | color, palette index 0 to 255 |
</dd>
<dt>See Also</dt><dd>
[move], [left], [right], [up], [down], [forw], [back]
</dd>
<hr>
## forw

```c
void forw(uint16_t cnt)
```
<dt>Description</dt><dd>
Moves turtle forward.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| cnt | amount in pixels (or 1/128 tiles with [maze]) |
</dd>
<dt>See Also</dt><dd>
[move], [left], [right], [up], [down], [color], [back]
</dd>
<hr>
## back

```c
void back(uint16_t cnt)
```
<dt>Description</dt><dd>
Moves turtle backward.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| cnt | amount in pixels (or 1/128 tiles with [maze]) |
</dd>
<dt>See Also</dt><dd>
[move], [left], [right], [up], [down], [color], [forw]
</dd>
<hr>
## spr

```c
void spr(int16_t x, int16_t y, uint16_t sprite, uint8_t sw, uint8_t sh, int8_t scale, uint8_t type)
```
<dt>Description</dt><dd>
Displays a sprite, or multiple adjacent sprites.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
| sprite | sprite id, 0 to 1023 |
| sw | number of horizontal sprites |
| sh | number of vertical sprites |
| scale | scale, -3 to 4 |
| type | transformation, 0=normal, 1=flip vertically, 2=flip horizontally, 3=rotate 90, 4=rotate 180, 5=rotate 270 |
</dd>
<dt>See Also</dt><dd>
[dlg], [stext]
</dd>
<hr>
## dlg

```c
void dlg(int16_t x, int16_t y, uint16_t w, uint16_t h, int8_t scale,
    uint16_t tl, uint16_t tm, uint16_t tr,
    uint16_t ml, uint16_t bg, uint16_t mr,
    uint16_t bl, uint16_t bm, uint16_t br)
```
<dt>Description</dt><dd>
Displays a dialog window using sprites.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
| w | dialog width in pixels |
| h | dialog height in pixels |
| scale | scale, -3 to 4 |
| tl | top left corner sprite id |
| tm | top middle sprite id |
| tr | top right corner sprite id |
| ml | middle left side sprite id |
| bg | background sprite id |
| mr | middle right side sprite id |
| bl | bottom left corner sprite id |
| bm | bottom middle sprite id |
| br | bottom right corner sprite id |
</dd>
<dt>See Also</dt><dd>
[spr], [stext]
</dd>
<hr>
## stext

```c
void stext(int16_t x, int16_t y, uint16_t fs, uint16_t fu, uint8_t sw, uint8_t sh, int8_t scale, str_t str)
```
<dt>Description</dt><dd>
Displays text on screen using sprites.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
| fs | first sprite id to be used for displaying |
| fu | first UNICODE (smallest character) in string |
| sw | number of horizontal sprites |
| sh | number of vertical sprites |
| scale | scale, -3 to 4 |
| str | zero terminated UTF-8 string |
</dd>
<dt>See Also</dt><dd>
[spr], [dlg]
</dd>
<hr>
## remap

```c
void remap(addr_t replace)
```
<dt>Description</dt><dd>
Replaces tiles on map. Can be used to animate tiles on the map.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| replace | an array of 256 sprite ids |
</dd>
<dt>See Also</dt><dd>
[mget], [mset], [map], [maze]
</dd>
<hr>
## mget

```c
uint16_t mget(uint16_t mx, uint16_t my)
```
<dt>Description</dt><dd>
Returns one tile on map.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| mx | X coordinate on map in tiles |
| my | Y coordinate on map in tiles |
</dd>
<dt>Return Value</dt><dd>
The sprite id of the tile at the given coordinate.
</dd>
<dt>See Also</dt><dd>
[remap], [mset], [map], [maze]
</dd>
<hr>
## mset

```c
void mset(uint16_t mx, uint16_t my, uint16_t sprite)
```
<dt>Description</dt><dd>
Sets one tile on map.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| mx | X coordinate on map in tiles |
| my | Y coordinate on map in tiles |
| sprite | sprite id, 0 to 1023 |
</dd>
<dt>See Also</dt><dd>
[remap], [mget], [map], [maze]
</dd>
<hr>
## map

```c
void map(int16_t x, int16_t y, uint16_t mx, uint16_t my, uint16_t mw, uint16_t mh, int8_t scale)
```
<dt>Description</dt><dd>
Draws (part of) the map.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| x | X coordinate in pixels |
| y | Y coordinate in pixels |
| mx | X coordinate on map in tiles |
| my | Y coordinate on map in tiles |
| mw | number of horizontal tiles |
| mh | number of vertical tiles |
| scale | scale, -3 to 4 |
</dd>
<dt>See Also</dt><dd>
[remap], [mget], [mset], [maze]
</dd>
<hr>
## maze

```c
void maze(uint16_t mx, uint16_t my, uint16_t mw, uint16_t mh, uint8_t scale,
    uint16_t sky, uint16_t grd, uint16_t door, uint16_t wall, uint16_t obj, uint8_t numnpc, addr_t npc)
```
<dt>Description</dt><dd>
Displays map as a 3D maze, using turtle's position.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| mx | X coordinate on map in tiles |
| my | Y coordinate on map in tiles |
| mw | number of horizontal tiles |
| mh | number of vertical tiles |
| scale | number of sprites per tiles in power of two, 0 to 3 |
| sky | sky tile index |
| grd | ground tile index |
| door | first door tile index |
| wall | first wall tile index |
| obj | first object tile index |
| numnpc | number of NPC records |
| npc | an uint32_t array of numnpc times x,y,tile index triplets |
</dd>
<dt>See Also</dt><dd>
[remap], [mget], [mset], [map]
</dd>

# Input

## getpad

```c
int getpad(int pad, int btn)
```
<dt>Description</dt><dd>
Gets the current state of a gamepad button.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| pad | gamepad index, 0 to 3 |
| btn | one of the [gamepad] buttons, `BTN_` |
</dd>
<dt>Return Value</dt><dd>
Zero if not pressed, non-zero if pressed.
</dd>
<dt>See Also</dt><dd>
[prspad], [relpad], [getbtn], [getclk], [getkey]
</dd>
<hr>
## prspad

```c
int prspad(int pad, int btn)
```
<dt>Description</dt><dd>
Returns true if gamepad button was pressed since last call.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| pad | gamepad index, 0 to 3 |
| btn | one of the [gamepad] buttons, `BTN_` |
</dd>
<dt>Return Value</dt><dd>
Zero if not pressed, non-zero if pressed.
</dd>
<dt>See Also</dt><dd>
[relpad], [getpad], [getbtn], [getclk], [getkey]
</dd>
<hr>
## relpad

```c
int relpad(int pad, int btn)
```
<dt>Description</dt><dd>
Returns true if gamepad button was released since last call.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| pad | gamepad index, 0 to 3 |
| btn | one of the [gamepad] buttons, `BTN_` |
</dd>
<dt>Return Value</dt><dd>
Zero if wasn't released, non-zero if released.
</dd>
<dt>See Also</dt><dd>
[prspad], [getpad], [getbtn], [getclk], [getkey]
</dd>
<hr>
## getbtn

```c
int getbtn(int btn)
```
<dt>Description</dt><dd>
Gets the mouse button's state.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| btn | one of the [pointer] buttons, `BTN_` or `SCR_` |
</dd>
<dt>Return Value</dt><dd>
Zero if not pressed, non-zero if pressed.
</dd>
<dt>See Also</dt><dd>
[prspad], [relpad], [getpad], [getclk], [getkey]
</dd>
<hr>
## getclk

```c
int getclk(int btn)
```
<dt>Description</dt><dd>
Gets mouse button clicking.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| btn | one of the [pointer] buttons, `BTN_` |
</dd>
<dt>Return Value</dt><dd>
Zero if not clciked, non-zero if clicked.
</dd>
<dt>See Also</dt><dd>
[prspad], [relpad], [getpad], [getbtn], [getkey]
</dd>
<hr>
## getkey

```c
int getkey(int sc)
```
<dt>Description</dt><dd>
Gets the current state of a key.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| sc | scancode, 1 to 144, see [keyboard] |
</dd>
<dt>Return Value</dt><dd>
Zero if not pressed, non-zero if pressed.
</dd>
<dt>See Also</dt><dd>
[prspad], [relpad], [getpad], [getbtn], [getclk]
</dd>
<hr>
## popkey

```c
uint32_t popkey(void)
```
<dt>Description</dt><dd>
Pop an UTF-8 key from the keyboard queue. See [keyboard], and for the blocking version [getc].
</dd>
<dt>Return Value</dt><dd>
The UTF-8 representation of the key, or 0 if the queue was empty (no blocking).
</dd>
<dt>See Also</dt><dd>
[pendkey], [lenkey], [speckey], [getc]
</dd>
<hr>
## pendkey

```c
int pendkey(void)
```
<dt>Description</dt><dd>
Returns true if there's a key pending in the queue (but leaves the key in the queue, does not pop it).
</dd>
<dt>Return Value</dt><dd>
Returns 1 if there are keys in the queue pending.
</dd>
<dt>See Also</dt><dd>
[pendkey], [lenkey], [speckey]
</dd>
<hr>
## lenkey

```c
int lenkey(uint32_t key)
```
<dt>Description</dt><dd>
Returns the length of a UTF-8 key in bytes.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| key | the key, popped from the queue |
</dd>
<dt>Return Value</dt><dd>
UTF-8 representation's length in bytes.
</dd>
<dt>See Also</dt><dd>
[popkey], [pendkey], [speckey]
</dd>
<hr>
## speckey

```c
int speckey(uint32_t key)
```
<dt>Description</dt><dd>
Returns true if key is a special key.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| key | the key, popped from the queue |
</dd>
<dt>Return Value</dt><dd>
Returns 1 if it's a special key, and 0 if it's a printable one.
</dd>
<dt>See Also</dt><dd>
[popkey], [pendkey], [lenkey]
</dd>

# Mathematics

## rand

```c
uint32_t rand(void)
```
<dt>Description</dt><dd>
Get random. Use `%` modulo to make it smaller, for example `1 + rand() % 6` returns random between 1 and 6, like a dice.
</dd>
<dt>Return Value</dt><dd>
A random number between 0 and 2^^32^^-1 (4294967295).
</dd>
<dt>See Also</dt><dd>
[rnd]
</dd>
<hr>
## rnd

```c
float rnd(void)
```
<dt>Description</dt><dd>
Get random. Same as [rand], but returns a floating point number.
</dd>
<dt>Return Value</dt><dd>
A random number between 0.0 and 1.0.
</dd>
<dt>See Also</dt><dd>
[rand]
</dd>
<hr>
## float

```c
float float(int val)
```
<dt>Description</dt><dd>
Returns the floating point equivalent of an integer number.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
The floating point of value.
</dd>
<dt>See Also</dt><dd>
[int]
</dd>
<hr>
## int

```c
int int(float val)
```
<dt>Description</dt><dd>
Returns the integer equivalent of a floating point number.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
The integer of value.
</dd>
<dt>See Also</dt><dd>
[float]
</dd>
<hr>
## floor

```c
float floor(float val)
```
<dt>Description</dt><dd>
Returns the largest integral number that's not greater than value.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
The floor of value.
</dd>
<dt>See Also</dt><dd>
[ceil]
</dd>
<hr>
## ceil

```c
float ceil(float val)
```
<dt>Description</dt><dd>
Returns the smallest integral number that's not less than value.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
The ceiling of value.
</dd>
<dt>See Also</dt><dd>
[floor]
</dd>
<hr>
## sgn

```c
float sgn(float val)
```
<dt>Description</dt><dd>
Returns the sign of the value.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
Either 1.0 or -1.0.
</dd>
<dt>See Also</dt><dd>
[abs]
</dd>
<hr>
## abs

```c
float abs(float val)
```
<dt>Description</dt><dd>
Returns the absolute of the value.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
Either value or -value, always positive.
</dd>
<dt>See Also</dt><dd>
[sgn]
</dd>
<hr>
## exp

```c
float exp(float val)
```
<dt>Description</dt><dd>
Returns the exponential of the value, i.e. base of natural logarithms raised to power of the value.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
Returns e^^val^^.
</dd>
<dt>See Also</dt><dd>
[log], [pow]
</dd>
<hr>
## log

```c
float log(float val)
```
<dt>Description</dt><dd>
Returns the natural logarithm of the value.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
Returns natural logarithm of val.
</dd>
<dt>See Also</dt><dd>
[exp]
</dd>
<hr>
## pow

```c
float pow(float val, float exp)
```
<dt>Description</dt><dd>
Returns the value raised to the power of exponent. This is a slow operation, try to avoid.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
| exp | exponent |
</dd>
<dt>Return Value</dt><dd>
Returns val^^exp^^.
</dd>
<dt>See Also</dt><dd>
[exp], [sqrt], [rsqrt]
</dd>
<hr>
## sqrt

```c
float sqrt(float val)
```
<dt>Description</dt><dd>
Returns the square root of the value. This is a slow operation, try to avoid.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
Square root.
</dd>
<dt>See Also</dt><dd>
[pow], [rsqrt]
</dd>
<hr>
## rsqrt

```c
float rsqrt(float val)
```
<dt>Description</dt><dd>
Returns the reciprocal of the square root of the value (`1 / sqrt(val)`). Uses John Carmack's fast method.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value |
</dd>
<dt>Return Value</dt><dd>
Reciprocal of the square root.
</dd>
<dt>See Also</dt><dd>
[pow], [sqrt]
</dd>
<hr>
## pi

```c
float pi(void)
```
<dt>Description</dt><dd>
Returns π as a floating point number.
</dd>
<dt>Return Value</dt><dd>
The value 3.14159265358979323846.
</dd>
<hr>
## cos

```c
float cos(uint16_t deg)
```
<dt>Description</dt><dd>
Returns cosine.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| deg | degree, 0 to 359, 0 is up, 90 on the right |
</dd>
<dt>Return Value</dt><dd>
Cosine of the degree, between -1.0 to 1.0.
</dd>
<dt>See Also</dt><dd>
[sin], [tan], [acos], [asin], [atan], [atan2]
</dd>
<hr>
## sin

```c
float sin(uint16_t deg)
```
<dt>Description</dt><dd>
Returns sine.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| deg | degree, 0 to 359, 0 is up, 90 to the right |
</dd>
<dt>Return Value</dt><dd>
Sine of the degree, between -1.0 to 1.0.
</dd>
<dt>See Also</dt><dd>
[cos], [tan], [acos], [asin], [atan], [atan2]
</dd>
<hr>
## tan

```c
float tan(uint16_t deg)
```
<dt>Description</dt><dd>
Returns tangent.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| deg | degree, 0 to 359, 0 is up, 90 to the right |
</dd>
<dt>Return Value</dt><dd>
Tangent of the degree, between -1.0 to 1.0.
</dd>
<dt>See Also</dt><dd>
[cos], [sin], [acos], [asin], [atan], [atan2]
</dd>
<hr>
## acos

```c
uint16_t acos(float val)
```
<dt>Description</dt><dd>
Returns arcus cosine.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value, -1.0 to 1.0 |
</dd>
<dt>Return Value</dt><dd>
Arcus cosine in degree, 0 to 359, 0 is up, 90 to the right.
</dd>
<dt>See Also</dt><dd>
[cos], [sin], [tan], [asin], [atan], [atan2]
</dd>
<hr>
## asin

```c
uint16_t asin(float val)
```
<dt>Description</dt><dd>
Returns arcus sine.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value, -1.0 to 1.0 |
</dd>
<dt>Return Value</dt><dd>
Arcus sine in degree, 0 to 359, 0 is up, 90 to the right.
</dd>
<dt>See Also</dt><dd>
[cos], [sin], [tan], [acos], [atan], [atan2]
</dd>
<hr>
## atan

```c
uint16_t atan(float val)
```
<dt>Description</dt><dd>
Returns arcus tangent.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| val | value, -1.0 to 1.0 |
</dd>
<dt>Return Value</dt><dd>
Arcus tangent in degree, 0 to 359, 0 is up, 90 to the right.
</dd>
<dt>See Also</dt><dd>
[cos], [sin], [tan], [acos], [asin], [atan2]
</dd>
<hr>
## atan2

```c
uint16_t atan2(float y, float x)
```
<dt>Description</dt><dd>
Returns arcus tangent for y/x, using the signs of y and x to determine the quadrant.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| y | Y coordinate |
| x | X coordinate |
</dd>
<dt>Return Value</dt><dd>
Arcus tangent in degree, 0 to 359, 0 is up, 90 to the right.
</dd>
<dt>See Also</dt><dd>
[cos], [sin], [tan], [acos], [asin]
</dd>

# Memory

## inb

```c
uint8_t inb(addr_t src)
```
<dt>Description</dt><dd>
Read in one byte from memory.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| src | address, 0x00000 to 0xBFFFF |
</dd>
<dt>Return Value</dt><dd>
Returns the value at that address.
</dd>
<hr>
## inw

```c
uint16_t inw(addr_t src)
```
<dt>Description</dt><dd>
Read in a word (two bytes) from memory.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| src | address, 0x00000 to 0xBFFFE |
</dd>
<dt>Return Value</dt><dd>
Returns the value at that address.
</dd>
<hr>
## ini

```c
uint32_t ini(addr_t src)
```
<dt>Description</dt><dd>
Read in a long word (four bytes) from memory.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| src | address, 0x00000 to 0xBFFFC |
</dd>
<dt>Return Value</dt><dd>
Returns the value at that address.
</dd>
<hr>
## outb

```c
void outb(addr_t dst, uint8_t value)
```
<dt>Description</dt><dd>
Write one byte to memory.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | address, 0x00000 to 0xBFFFF |
| value | value to set, 0 to 255 |
</dd>
<hr>
## outw

```c
void outw(addr_t dst, uint16_t value)
```
<dt>Description</dt><dd>
Write a word (two bytes) to memory.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | address, 0x00000 to 0xBFFFE |
| value | value to set, 0 to 65535 |
</dd>
<hr>
## outi

```c
void outi(addr_t dst, uint32_t value)
```
<dt>Description</dt><dd>
Write a long word (four bytes) to memory.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | address, 0x00000 to 0xBFFFC |
| value | value to set, 0 to 4294967295 |
</dd>
<hr>
## memsave

```c
int memsave(uint8_t overlay, addr_t src, uint32_t size)
```
<dt>Description</dt><dd>
Saves memory area to overlay.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| overlay | index of overlay to write to, 0 to 255 |
| src | memory offset to save from, 0x00000 to 0xBFFFF |
| size | number of bytes to save |
</dd>
<dt>Return Value</dt><dd>
Returns 1 on success, 0 on error.
</dd>
<dt>See Also</dt><dd>
[memload]
</dd>
<hr>
## memload

```c
int memload(addr_t dst, uint8_t overlay, uint32_t maxsize)
```
<dt>Description</dt><dd>
Loads an overlay into the specified memory area.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | memory offset to load to, 0x00000 to 0xBFFFF |
| overlay | index of overlay to read from, 0 to 255 |
| maxsize | maximum number of bytes to load |
</dd>
<dt>Return Value</dt><dd>
Returns the number of bytes actually loaded.
</dd>
<dt>See Also</dt><dd>
[memsave]
</dd>
<hr>
## memcpy

```c
void memcpy(addr_t dst, addr_t src, uint32_t len)
```
<dt>Description</dt><dd>
Copy memory regions.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | destination address, 0x00000 to 0xBFFFF |
| src | source address, 0x00000 to 0xBFFFF |
| len | number of bytes to copy |
</dd>
<hr>
## memset

```c
void memset(addr_t dst, uint8_t value, uint32_t len)
```
<dt>Description</dt><dd>
Set memory region to a given value.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | destination address, 0x00000 to 0xBFFFF |
| value | value to set, 0 to 255 |
| len | number of bytes to set |
</dd>
<hr>
## memcmp

```c
int memcmp(addr_t addr0, addr_t addr1, uint32_t len)
```
<dt>Description</dt><dd>
Compare memory regions.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| addr0 | first address, 0x00000 to 0xBFFFF |
| addr1 | second address, 0x00000 to 0xBFFFF |
| len | number of bytes to compare |
</dd>
<dt>Return Value</dt><dd>
Returns difference, 0 if the two memory region matches.
</dd>
<hr>
## deflate

```c
int deflate(addr_t dst, addr_t src, uint32_t len)
```
<dt>Description</dt><dd>
Compress a buffer using RFC1950 deflate (zlib).
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | destination address, 0x30000 to 0xBFFFF |
| src | source address, 0x30000 to 0xBFFFF |
| len | number of bytes to compress |
</dd>
<dt>Return Value</dt><dd>
0 or negative on error, otherwise the length of the compressed buffer and compressed data in dst.
</dd>
<dt>See Also</dt><dd>
[inflate]
</dd>
<hr>
## inflate

```c
int inflate(addr_t dst, addr_t src, uint32_t len)
```
<dt>Description</dt><dd>
Uncompress a buffer with RFC1950 deflate (zlib) compressed data.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| dst | destination address, 0x30000 to 0xBFFFF |
| src | source address, 0x30000 to 0xBFFFF |
| len | number of compressed bytes |
</dd>
<dt>Return Value</dt><dd>
0 or negative on error, otherwise the length of the uncompressed buffer and uncompressed data in dst.
</dd>
<dt>See Also</dt><dd>
[deflate]
</dd>
<hr>
## time

```c
float time(void)
```
<dt>Description</dt><dd>
Returns the number of ticks since power on.
</dd>
<dt>Return Value</dt><dd>
The elapsed time in milliseconds since power on.
</dd>
<dt>See Also</dt><dd>
[now]
</dd>
<hr>
## now

```c
uint32_t now(void)
```
<dt>Description</dt><dd>
Returns the UNIX timestamp. Check the byte at offset 0000C to see if it overflows.
</dd>
<dt>Return Value</dt><dd>
The elapsed time in seconds since 1 Jan 1970 midnight, Greenwich Mean Time.
</dd>
<dt>See Also</dt><dd>
[time]
</dd>
<hr>
## atoi

```c
int atoi(str_t src)
```
<dt>Description</dt><dd>
Converts an ASCII decimal string into an integer number.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| src | string address, 0x00000 to 0xBFFFF |
</dd>
<dt>Return Value</dt><dd>
The number value of the string.
</dd>
<dt>See Also</dt><dd>
[itoa], [str], [val]
</dd>
<hr>
## itoa

```c
str_t itoa(int value)
```
<dt>Description</dt><dd>
Converts an integer number into an ASCII decimal string.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| value | the value, -2147483648 to 2147483647 |
</dd>
<dt>Return Value</dt><dd>
The converted string.
</dd>
<dt>See Also</dt><dd>
[atoi], [str], [val]
</dd>
<hr>
## val

```c
float val(str_t src)
```
<dt>Description</dt><dd>
Converts an ASCII decimal string into a floating point number.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| src | string address, 0x00000 to 0xBFFFF |
</dd>
<dt>Return Value</dt><dd>
The number value of the string.
</dd>
<dt>See Also</dt><dd>
[itoa], [atoi], [str]
</dd>
<hr>
## str

```c
str_t str(float value)
```
<dt>Description</dt><dd>
Converts a floating point number into an ASCII decimal string.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| value | the value |
</dd>
<dt>Return Value</dt><dd>
The converted string.
</dd>
<dt>See Also</dt><dd>
[atoi], [itoa], [val]
</dd>
<hr>
## sprintf

```c
str_t sprintf(str_t fmt, ...)
```
<dt>Description</dt><dd>
Returns a zero terminated UTF-8 string created using format and arguments.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| fmt | [format string] |
| ... | optional arguments |
</dd>
<dt>Return Value</dt><dd>
Constructed string.
</dd>
<hr>
## strlen

```c
int strlen(str_t src)
```
<dt>Description</dt><dd>
Return the number of bytes in a string (without the terminating zero).
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| src | string address, 0x00000 to 0xBFFFF |
</dd>
<dt>Return Value</dt><dd>
The number of bytes in the string.
</dd>
<dt>See Also</dt><dd>
[mblen]
</dd>
<hr>
## mblen

```c
int mblen(str_t src)
```
<dt>Description</dt><dd>
Return the number of UTF-8 multi-byte characters in a string (without the terminating zero).
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| src | string address, 0x00000 to 0xBFFFF |
</dd>
<dt>Return Value</dt><dd>
The number of characters in the string.
</dd>
<dt>See Also</dt><dd>
[strlen]
</dd>
<hr>
## malloc

```c
addr_t malloc(uint32_t size)
```
<dt>Description</dt><dd>
Allocates user memory dynamically.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| size | number of bytes to allocate |
</dd>
<dt>Return Value</dt><dd>
Address of the new allocated buffer or NULL on error.
</dd>
<dt>See Also</dt><dd>
[realloc], [free]
</dd>
<hr>
## realloc

```c
addr_t realloc(addr_t addr, uint32_t size)
```
<dt>Description</dt><dd>
Resize a previously allocated buffer.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| addr | address of the allocated buffer |
| size | number of bytes to resize to |
</dd>
<dt>Return Value</dt><dd>
Address of the new allocated buffer or NULL on error.
</dd>
<dt>See Also</dt><dd>
[malloc], [free]
</dd>
<hr>
## free

```c
int free(addr_t addr)
```
<dt>Description</dt><dd>
Frees dynamically allocated user memory.
</dd>
<dt>Parameters</dt><dd>
| Argument | Description |
| addr | address of the allocated buffer |
</dd>
<dt>Return Value</dt><dd>
1 on success, 0 on error.
</dd>
<dt>See Also</dt><dd>
[malloc], [realloc]
</dd>
